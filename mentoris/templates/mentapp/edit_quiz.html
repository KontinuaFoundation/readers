<!DOCTYPE html>
<html>
<<<<<<< HEAD
<<<<<<< HEAD

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Edit Quiz</title>

    <link rel="stylesheet" type="text/css"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />

<<<<<<< HEAD
    {% load static %}
    <link rel="stylesheet" href="{% static '/css/colors.css'%}">
    <link rel="stylesheet" href="{% static '/css/quiz_styles.css'%}">

    <script src="https://cdn.jsdelivr.net/npm/latex.js/dist/latex.js"></script>
<<<<<<< HEAD
    <script src="{% static " /scripts/toggle_attachments_visible.js" %}"></script>
=======
>>>>>>> 0bb1265 (fixes)
    <script>
        customElements.define("latex-js", latexjs.LaTeXJSComponent);
    </script>

    <style>
        .delete {
            font-weight: bold;
            background: var(--KontinuaRed);
        }

        .question_support_label {
            text-align: center;
            border: 2px solid Black;
            border-radius: 25px;
<<<<<<< HEAD
            margin: 0px;
            width: 100%;
            height: 2em;
            background-color: var(--KontinuaBlue);

        }

        #quiz_content {
            width: 35em;
        }

        #quiz_content {
            padding: 10px;
            float: left;
            margin-bottom: 0px;
        }
    </style>

</head>
=======
=======
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Edit Quiz</title>
        
        <link
        rel="stylesheet"
        type="text/css"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        />
        
>>>>>>> 1c5155a (JavaScript rewrite for editing quizzes, Quiz Label, LaTeX image support with URL (implemented edit_quiz and associated add_question and add_support pages))
        {% load static %}
        <link rel="stylesheet" href="{% static "/css/colors.css"%}">
        <link rel="stylesheet" href="{% static "/css/quiz_styles.css"%}">

=======
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Edit Quiz</title>
        
        <link
        rel="stylesheet"
        type="text/css"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        />
        
        {% load static %}
        <link rel="stylesheet" href="{% static "/css/colors.css"%}">
        <link rel="stylesheet" href="{% static "/css/quiz_styles.css"%}">

<<<<<<< HEAD
<<<<<<< HEAD
>>>>>>> a8bcbf5 (JavaScript rewrite for editing quizzes, Quiz Label, LaTeX image support with URL (implemented edit_quiz and associated add_question and add_support pages))
        <script src= "{% static "/scripts/generate_quiz_html.js" %}"></script>
<<<<<<< HEAD
=======
        <script src= "{% static '/scripts/generate_quiz_html.js' %}"></script>
>>>>>>> 66ff12b (fully functional)
=======
        <script src= "{% static "/scripts/generate_quiz_html.js" %}"></script>
>>>>>>> a943d23 (LaTeX macro ready, times out when saving due to pdf generation)
        <script src="https://cdn.jsdelivr.net/npm/latex.js/dist/latex.js"></script>
        <script>
            customElements.define("latex-js", latexjs.LaTeXJSComponent);
        </script>
=======
>>>>>>> 8f5f498 (Commit)

        <style>

            .delete {
                font-weight: bold;
                background: var(--KontinuaRed);
            }

            .question_support_label {
                text-align: center;
                border: 2px solid Black;
                border-radius: 25px;
                margin: 0px;
                width: 100%;
                height: 2em;
                background-color:  var(--KontinuaBlue);
                
            }

        </style>

    </head>
>>>>>>> 0f14dbf (view supports)

    <body>
        <!--Include AJAX-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
        <!--Include Header-->
        <iframe src="header.html" width="100%" height="95px" frameBorder="0" style="display: block; padding: 0px; margin: 0px;"></iframe>
        
        <button id="back_button" onclick="confirmLeave()" type="button">Back to Quizzes</button>
        <br>

<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
=======
            margin: 5px;
            width: 8em;
            height: 2em;
            vertical-align: middle;
        }

        #quiz_content {
            width: 35em;
        }

        #quiz_content {
            padding: 10px;
            float: left;
            margin-bottom: 0px;
        }
    </style>

</head>

    <body>
        <!--Include AJAX-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
        <!--Include Header-->
        <iframe src="header.html" width="100%" height="95px" frameBorder="0" style="display: block; padding: 0px; margin: 0px;"></iframe>
        
        <button id="back_button" onclick="confirmLeave()" type="button">Back to Quizzes</button>
        <br>

<<<<<<< HEAD
>>>>>>> 0bb1265 (fixes)
=======
    <button id="back_button" onclick="location.href='/main/'" type="button">Back to Quizzes</button>
=======
    <button id="back_button" onclick="confirmLeave()" type="button">Back to Quizzes</button>
>>>>>>> 830dbfb (save changes windows)
    <br>

>>>>>>> aabf7f6 (edit/delete quiz buttons)
    <div id="quiz_content" class="bordered" background="red">
        <ul id="quiz_questions_list" style="list-style-type:none;">
            {% for question_Loc_and_quiz in questions_Loc_and_quiz %}
            <li id="{{question_Loc_and_quiz.0.question.question_id}}">
                <div class="bordered">
<<<<<<< HEAD

                    <p class="bold_font question_support_label">
                        Question
                    </p>
                    <div style="float: left;">
                        <p class="small_margin">
                            <span class="bold_font">Ordering: </span>
                            <span class="question_ordering">{{question_Loc_and_quiz.1.ordering}}</span>
                        </p>
                        <p class="small_margin">
                            <span class="bold_font">Difficulty: </span>
                            {{question_Loc_and_quiz.0.question.conceptual_difficulty}}
                        </p>
                        <p class="small_margin">
                            <span class="bold_font">Volume: </span>
                            {{question_Loc_and_quiz.0.question.chapter.volume.volume_id}}
                        </p>
                        <p class="small_margin">
                            <span class="bold_font">Chapter: </span>
                            {{question_Loc_and_quiz.0.question.chapter.chapter_id}}
                        </p>
                        <p class="small_margin">
                            <span class="bold_font">Creator: </span>
                            {{question_Loc_and_quiz.0.question.creator.full_name}}
                        </p>
                        <p class="small_margin">
                            <span class="bold_font">Point Value: </span>
                            {{question_Loc_and_quiz.0.question.point_value}}
                        </p>
                        <p class="small_margin">
                            <span class="bold_font">Time (minutes): </span>
                            {{question_Loc_and_quiz.0.question.time_required_mins}}
                        </p>
                    </div>
                    <div style="float: right;">
                        <ul style="list-style-type:none;">
                            <li>
                                <button class="delete question_button">Delete</button>
                            </li>
                            <li>
                                <button class="decrease_order question_button">
                                    <img src="{% static 'up_arrow.svg' %}" width="50" />
                                </button>
                            </li>

                            <li>
                                <button class="increase_order question_button">
                                    <img src="{% static 'down_arrow.svg' %}" width="50" />
                                </button>
                            </li>
                        </ul>
                    </div>
                    <div style="clear: both;">
                        <latex-js>{{question_Loc_and_quiz.0.question_latex}}</latex-js>

                        {% if question_Loc_and_quiz.2 %}
                        <div style="float: right">
                            <button class="attachments_button invisible_state bold_font">Show Attatchments</button>
                        </div>
                        <div class="bordered attachments" style="clear:both; display: none;">
                            {% for image in question_Loc_and_quiz.2%}
                            <img src="{{image.url}}" width="200" style="position:relative; left: 25%">
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>
<<<<<<< HEAD

    <div id="right_panel">
        <div class="bordered" id="meta_data">
            <form action="" method="post">
                <div class="form_element_wrapper">
                    <span class="form_label">Conceptual Difficulty: </span>
                    <input type="text" id="conceptual_difficulty" value={{quiz_instance.conceptual_difficulty}}>
                </div>
                <div class="form_element_wrapper">
                    <span class="form_label">Time Required (mins): </span>
                    <input type="text" id="time_required_mins" value={{quiz_instance.time_required_mins}}>
                </div>
                <div class="form_element_wrapper">
                    <span class="form_label">Calculator Allowed: </span>
                    <input type="checkbox" id="calculator_allowed" {% if quiz_instance.calculator_allowed %} checked {%
                        endif %}>
                </div>
                <div class="form_element_wrapper">
                    <span class="form_label">Computer Allowed: </span>
                    <input type="checkbox" id="computer_allowed" {% if quiz_instance.computer_allowed %} checked {%
                        endif %}>
                </div>
                <div class="form_element_wrapper">
                    <span class="form_label">Internet Allowed: </span>
                    <input type="checkbox" id="internet_allowed" {% if quiz_instance.internet_allowed %} checked {%
                        endif %}>
                </div>
                <div class="form_element_wrapper">
                    <span class="form_label">Book Allowed: </span>
                    <input type="checkbox" id="book_allowed" {% if quiz_instance.book_allowed %} checked {% endif %}>
                </div>
                <div class="form_element_wrapper">
                    <span class="form_label">Volume: </span>
                    <select id="volume" name="volume">
                        {% for volume in volumes %}
                        <option value="{{volume.volume_id}}" {% if quiz_instance.volume.volume_id==volume.volume_id %}
                            selected {% endif %}>{{volume.volume_id}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form_element_wrapper">
                    <span class="form_label">Chapter: </span>
                    <select id="chapter" name="chapter">
                        {% for chapter in chapters %}
                        <option value="{{chapter.chapter_id}}" {% if
                            quiz_instance.chapter.chapter_id==chapter.chapter_id %} selected {% endif %}>
                            {{chapter.chapter_id}}</option>
                        {% endfor %}
                    </select>
                </div>

=======
                    <div>
                        <div style="float: left;">
                            <p class="small_margin">
                                <span class="bold_font">Ordering: </span>
                                <span class="question_ordering">{{question_Loc_and_quiz.1.ordering}}</span>
                            </p>
                            <p class="small_margin">
                                <span class="bold_font">Difficulty: </span>
                                {{question_Loc_and_quiz.0.question.conceptual_difficulty}}
                            </p>
                            <p class="small_margin">
                                <span class="bold_font">Volume: </span>
                                {{question_Loc_and_quiz.0.question.chapter.volume.volume_id}}
                            </p>
                            <p class="small_margin">
                                <span class="bold_font">Chapter: </span>
                                {{question_Loc_and_quiz.0.question.chapter.chapter_id}}
                            </p>
                            <p class="small_margin">
                                <span class="bold_font">Creator: </span>
                                {{question_Loc_and_quiz.0.question.creator.full_name}}
                            </p>
                            <p class="small_margin">
                                <span class="bold_font">Point Value: </span>
                                {{question_Loc_and_quiz.0.question.point_value}}
                            </p>
                            <p class="small_margin">
                                <span class="bold_font">Time (minutes): </span>
                                {{question_Loc_and_quiz.0.question.time_required_mins}}
                            </p>
                        </div>
                        <div style="float: right;">
                            <ul style="list-style-type:none;">
                                <li>
                                    <button class="delete question_button">Delete</button>
                                </li>
                                <li>
                                    <button class="decrease_order question_button">
                                        <img src="{% static 'up_arrow.svg' %}" width="50" />
                                    </button>
                                </li>

                                <li>
                                    <button class="increase_order question_button">
                                        <img src="{% static 'down_arrow.svg' %}" width="50" />
                                    </button>
                                </li>
                            </ul>
                        </div>
                        <div style="clear: both;">
                            <latex-js>{{question_Loc_and_quiz.0.question_latex}}</latex-js>
                        </div>
                        <div style="float: right;">
                            <p class="bold_font question_support_label" style="background-color:  var(--KontinuaBlue);">
                                Question</p>
                        </div>
                    </div>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>

    <div id="right_panel">
        <div class="bordered" id="meta_data">
            <form action="" method="post">
                {% csrf_token %}
                <table>
                    {{form.as_table}}
                </table>
                <input type="submit" value="Submit" />
>>>>>>> 0bb1265 (fixes)
            </form>
=======
    
            <div id="right_panel">
                <div class="bordered" id="meta_data">
                    <form action="" method="post">
                        <div class="form_element_wrapper">
                            <span class="form_label">Conceptual Difficulty: </span>
                            <input type="text" id="conceptual_difficulty" value={{quiz_instance.conceptual_difficulty}}>
                        </div>
                        <div class="form_element_wrapper">
                            <span class="form_label">Time Required (mins): </span>
                            <input type="text" id="time_required_mins" value={{quiz_instance.time_required_mins}}>
                        </div>
                        <div class="form_element_wrapper">
                            <span class="form_label">Calculator Allowed: </span>
                            <input type="checkbox" id="calculator_allowed" {% if quiz_instance.calculator_allowed %}
                                checked {% endif %}>
                        </div>
                        <div class="form_element_wrapper">
                            <span class="form_label">Computer Allowed: </span>
                            <input type="checkbox" id="computer_allowed" {% if quiz_instance.computer_allowed %} checked
                                {% endif %}>
                        </div>
                        <div class="form_element_wrapper">
                            <span class="form_label">Internet Allowed: </span>
                            <input type="checkbox" id="internet_allowed" {% if quiz_instance.internet_allowed %} checked
                                {% endif %}>
                        </div>
                        <div class="form_element_wrapper">
                            <span class="form_label">Book Allowed: </span>
                            <input type="checkbox" id="book_allowed" 
                            {% if quiz_instance.book_allowed %} 
                                checked
                            {% endif %}>
                        </div>
                        <div class="form_element_wrapper">
                            <span class="form_label">Volume: </span>
                            <select id="volume" name="volume">
                                {% for volume in volumes %}
                            <option value="{{volume.volume_id}}"
                            {% if quiz_instance.volume.volume_id == volume.volume_id %}
                                selected
                            {% endif %}
                            >{{volume.volume_id}}</option>
                        {% endfor %}

                            </select>
                        </div>
                        <div class="form_element_wrapper">
                            <span class="form_label">Chapter: </span>
                            <select id="chapter" name="chapter">
                                {% for chapter in chapters %}
                                    <option value="{{chapter.chapter_id}}" 
                                    {% if quiz_instance.chapter.chapter_id == chapter.chapter_id %}
                                        selected
                                    {% endif %}
                                    >{{chapter.chapter_id}}</option>
                                {% endfor %}
                            </select>
                        </div>
>>>>>>> 0f14dbf (view supports)

<<<<<<< HEAD
=======
                    </form>

                </div>
                <button class="question_button" id="add_question"
                    onclick="location.href='/edit_quiz_add_question/{{quiz_instance.quiz_id}}'" type="button">Add
                    Question
                </button>
                <button class="question_button" id="add_support"
                    onclick="location.href='/edit_quiz_add_support/{{quiz_instance.quiz_id}}'">Add Support
                </button>
                <button class="question_button" id="save_button">Save</button>
                <div id="save_status" class="bordered"></div>
            </div>
>>>>>>> c58b4ad (Initial changes for pdf rendering)
=======
        <div id = "quiz_content" class = "bordered">
            <ul id = "questions_list" style="list-style-type:none;">
            </ul>
>>>>>>> 1c5155a (JavaScript rewrite for editing quizzes, Quiz Label, LaTeX image support with URL (implemented edit_quiz and associated add_question and add_support pages))
=======
        <div id = "quiz_content" class = "bordered">
            <ul id = "questions_list" style="list-style-type:none;">
            </ul>
>>>>>>> a8bcbf5 (JavaScript rewrite for editing quizzes, Quiz Label, LaTeX image support with URL (implemented edit_quiz and associated add_question and add_support pages))
        </div>
<<<<<<< HEAD
        <button class="question_button" id="add_question"
            onclick="location.href='/edit_quiz_add_question/{{quiz_instance.quiz_id}}'" type="button">Add Question
        </button>
<<<<<<< HEAD
<<<<<<< HEAD
        <button class="question_button" id="add_support"
            onclick="location.href='/edit_quiz_add_support/{{quiz_instance.quiz_id}}'">Add Support
        </button>
        <button class="question_button" id="save_button">Save</button>
        <div id="save_status" class="bordered"></div>
=======
        <button class="question_button">Add Support</button>
=======
        <button class="question_button" id="add_support"
            onclick="location.href='/edit_quiz_add_support/{{quiz_instance.quiz_id}}'">Add Support
        </button>
>>>>>>> cbf594b (fixed creator/approver id)
        <button class="question_button" id="save_button">Save</button>
        <div id="save_status" class="bordered" style="width:30em;"></div>
>>>>>>> 0bb1265 (fixes)
    </div>
    </div>
=======
            <button class="question_button" id = "add_question" 
                onclick="location.href='/edit_quiz_add_question/{{quiz_instance.quiz_id}}'" 
                type="button">Add Question
            </button>
            <button class="question_button">Add Support</button>
            <button class="question_button" id = "save_button">Save</button>
            <button class="question_button" id="download_button">Download Quiz</button>
            <div id="save_status" class="bordered"></div> 
    </div>       
</div>
>>>>>>> f775257 (Initial changes for pdf rendering)

<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
    <iframe src="footer.html" width="100%" frameBorder="0"></iframe>

=======
        <iframe src="footer.html" width="100%" frameBorder="0"></iframe>
>>>>>>> 0f14dbf (view supports)
=======
=======
=======
=======
>>>>>>> a8bcbf5 (JavaScript rewrite for editing quizzes, Quiz Label, LaTeX image support with URL (implemented edit_quiz and associated add_question and add_support pages))
        <div id = "right_panel">
            <div class="bordered" id = "meta_data">
                <form action="" method="post">
                    <div class="form_element_wrapper">
                        <span class = "form_label">Quiz Label: </span>
                        <input type = "text" id = "label" value = "{{quiz_instance.label}}">
                    </div>
                    <div class="form_element_wrapper">
                        <span class = "form_label">Conceptual Difficulty: </span>
                        <input type = "text" id = "conceptual_difficulty" value = {{quiz_instance.conceptual_difficulty}}>
                    </div>
                    <div class="form_element_wrapper">
                        <span class = "form_label">Time Required (mins): </span>
                        <input type = "text" id = "time_required_mins" value ={{quiz_instance.time_required_mins}}>
                    </div>
                    <div class="form_element_wrapper">
                        <span class = "form_label">Calculator Allowed: </span>
                        <input type = "checkbox" id = "calculator_allowed" 
                            {% if quiz_instance.calculator_allowed %}
                                checked
                            {% endif %}
                        >
                    </div>
                    <div class="form_element_wrapper">
                        <span class = "form_label">Computer Allowed: </span>
                        <input type = "checkbox" id = "computer_allowed"
                            {% if quiz_instance.computer_allowed %}
                                checked
                            {% endif %}
                        >
                    </div>
                    <div class = "form_element_wrapper">
                        <span class = "form_label">Internet Allowed: </span>
                        <input type = "checkbox" id = "internet_allowed"
                            {% if quiz_instance.internet_allowed %}
                                checked
                            {% endif %}
                        >
                    </div>
                    <div class = "form_element_wrapper">
                        <span class = "form_label">Book Allowed: </span>
                        <input type = "checkbox" id = "book_allowed"
                            {% if quiz_instance.book_allowed %}
                                checked
                            {% endif %}
                        >
                    </div>
                    <div class = "form_element_wrapper">
                        <span class = "form_label">Volume: </span>
                        <select id="volume" name="volume">
                            {% for volume in volumes %}
                                <option value="{{volume.volume_id}}"
                                {% if quiz_instance.volume.volume_id == volume.volume_id %}
                                    selected
                                {% endif %}
                                >{{volume.volume_id}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class = "form_element_wrapper">
                        <span class = "form_label">Chapter: </span>
                        <select id = "chapter" name = "chapter">
                            {% for chapter in chapters %}
                                <option value="{{chapter.chapter_id}}"
                                {% if quiz_instance.chapter.chapter_id == chapter.chapter_id %}
                                    selected
                                {% endif %}
                                >{{chapter.chapter_id}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </form>
            </div>
            <button class="question_button" id = "add_question" 
                onclick="location.href='/edit_quiz_add_question/{{quiz_instance.quiz_id}}'" 
                type="button">Add Question
            </button>
            <button class="question_button"
            onclick="location.href='/edit_quiz_add_support/{{quiz_instance.quiz_id}}'" 
                type="button"
            >Add Support</button>
            <button class="question_button" id = "save_button">Save</button>
            <div id="save_status" class="bordered"></div> 
            </div>       
        </div>
<<<<<<< HEAD
>>>>>>> 1c5155a (JavaScript rewrite for editing quizzes, Quiz Label, LaTeX image support with URL (implemented edit_quiz and associated add_question and add_support pages))
=======
>>>>>>> a8bcbf5 (JavaScript rewrite for editing quizzes, Quiz Label, LaTeX image support with URL (implemented edit_quiz and associated add_question and add_support pages))
        <div id="customModal" class="modal">
            <div class="modal-content">
                <p>Are you sure you want to leave this page?</p>
                <button class="modalButton" onclick="saveChanges()">Save Changes before leaving</button>
                <button class="modalButton" onclick="leaveWithoutSaving()">Leave Without Saving</button>
                <button class="modalButton" onclick="cancelLeave()">Cancel</button>
            </div>
        </div>

<<<<<<< HEAD
<<<<<<< HEAD
>>>>>>> 830dbfb (save changes windows)
        <iframe src="footer.html" width="40%" style="position: absolute; bottom: 0; left:0" frameBorder="0"></iframe>
>>>>>>> 9f05cc8 (footers + back buttons)

    <script type="text/javascript">

        $(document).ready(function () {
<<<<<<< HEAD

            // Function to handle saving
            $('#save_button').on('click', function (event) {
                var list = document.getElementById("quiz_questions_list").children;
                var ids = []

                for (var i = 0; i < list.length; ++i) {
                    ids.push(list[i].id);
                }


                var request = $.ajax({
                    type: "POST",
                    url: "/edit_quiz/{{quiz_instance.quiz_id}}",
                    dataType: 'json',
                    data: {
                        csrfmiddlewaretoken: "{{csrf_token}}",
                        command: "save",
                        ids: JSON.stringify(ids),
                        conceptual_difficulty: document.getElementById("conceptual_difficulty").value,
                        time_required_mins: document.getElementById("time_required_mins").value,
                        calculator_allowed: document.getElementById("calculator_allowed").checked,
                        computer_allowed: document.getElementById("computer_allowed").checked,
                        internet_allowed: document.getElementById("internet_allowed").checked,
                        book_allowed: document.getElementById("book_allowed").checked,
                        volume: document.getElementById("volume").value,
                        chapter: document.getElementById("chapter").value
                    }
<<<<<<< HEAD
=======


                    var request = $.ajax({
=======

        <iframe src="footer.html" width="100%" frameBorder="0"></iframe>
        <script type = "text/javascript">
            let quiz_state = new Map();

            function create_buttons(button_wrapper){
                let questions_list = document.getElementById("questions_list");
                let ul = document.createElement("ul");
                $(ul).addClass("unbulleted_list");

                let delete_button_li = document.createElement("li");
                let delete_button = document.createElement("button");
                delete_button.innerHTML = "Delete";
                $(delete_button).addClass("delete");
                delete_button.addEventListener('click', function(event){
                    remove(event.target, questions_list);
                });
                delete_button_li.appendChild(delete_button);
                
                let up_button_li = document.createElement("li");
                let up_button = document.createElement("button");
                let up_button_image = document.createElement("img");
                up_button_image.src = "{% static 'up_arrow.svg' %}";
                up_button_image.width = 50;
                up_button.appendChild(up_button_image);
                up_button.addEventListener('click', function(event){
                    decrease_order(event.target, questions_list);
                });
                up_button_li.appendChild(up_button);

                let down_button_li = document.createElement("li");
                let down_button = document.createElement("button");
                let down_button_image = document.createElement("img");
                down_button_image.src = "{% static 'down_arrow.svg' %}";
                down_button_image.width = 50;
                down_button.appendChild(down_button_image);
                down_button.addEventListener('click', function(event){
                    increase_order(event.target, questions_list);
                });
                down_button_li.appendChild(down_button);

                let edit_button_li = document.createElement("li");
                let edit_button = document.createElement("button");
                edit_button.innerHTML = "Edit";
                edit_button.addEventListener('click', function (event) {
                    let questions_list = document.getElementById("questions_list");
                    let list = questions_list.children;
                    let index = -1;

                    for (let i = 0; i < list.length; ++i) {
                        if (list[i].contains(event.target)) {
                            index = i;
                            break; 
                        }
                    }

                    if (index !== -1) {
                        let question_id = list[index].id;
                        if (question_id) {
                            window.location.href = "/edit_question/" + question_id;
                        } else {
                            console.error('Question ID not found');
                        }
                    } else {
                        console.error('Element not found in list');
                    }
                });
                edit_button_li.appendChild(edit_button);

                ul.appendChild(delete_button_li);
                ul.appendChild(up_button_li);
                ul.appendChild(down_button_li);
                ul.appendChild(edit_button_li);
                button_wrapper.appendChild(ul);
            }

             // Function to handle deletions
             function remove(button, questions_list) {
                let list_element = questions_list;
                let list = list_element.children;
                let index = -1;

                for(let i = 0; i < list.length; ++i){
                    if(list[i].contains(button)){
                        index = i;
                    }
                }

                for(let i = 0; i < list.length; ++i){
                    if(i > index){
                        list[i].getElementsByClassName("question_ordering")[0].innerHTML = (i - 1).toString();
                    }
                    if(list[i].contains(button)){
                        index = i;
                    }
                }
                list_element.removeChild(list[index]);
            }
            
            // Function to handle increasing order
            function increase_order(button, questions_list){
                let list_element = questions_list;
                let list = list_element.children;
            
                let index = -1;
                for(let i = 0; i < list.length; ++i){
                    if(list[i].contains(button)){
                        index = i;
                    }
                }
                
                if(index != list.length-1){
                    let temp = quiz_state.get(index);
                    temp["ordering"] = index + 1;
                    quiz_state.get(index + 1)["ordering"] = index;
                    quiz_state.set(index, quiz_state.get(index + 1));
                    quiz_state.set(index + 1, temp);

                    redisplay_questions("questions_list", create_buttons, quiz_state);
                    setTimeout( () => 
                    {
                        list[index + 1].scrollIntoView(true)
                    }, 500);
                    
                }
            }

            // Function to handle decreasing order
            function decrease_order(button, questions_list){
                let list_element = questions_list;
                let list = list_element.children;
            
                let index = -1;
                for(let i = 0; i < list.length; ++i){
                    if(list[i].contains(button)){
                        index = i;
                    }
                }

                
                if(index != 0){
                    let temp = quiz_state.get(index);
                    temp["ordering"] = index - 1;
                    quiz_state.get(index - 1)["ordering"] = index;
                    quiz_state.set(index, quiz_state.get(index - 1));
                    quiz_state.set(index -1, temp);

                    
                    list_element =  document.getElementById("questions_list")
                    redisplay_questions("questions_list", create_buttons, quiz_state);
                    setTimeout( () => 
                        {
                            list[index - 1].scrollIntoView(true)
                        }, 500);
                }
            }

            $(document).ready(function() {
                // Fetch questions list
                let request = $.ajax({
                    type: "GET",
                    url: "/edit_quiz/{{quiz_instance.quiz_id}}",
                    dataType: 'json',
                    data:{
                        csrfmiddlewaretoken: "{{csrf_token}}",
                        command: "fetch_quiz_questions"
                    }
                });
                request.done(function(data){
                    display_questions(data, "questions_list", create_buttons, true, quiz_state);
                });

                // Function to handle saving
                $('#save_button').on('click', function(event){
                    let list = document.getElementById("questions_list").children;
                    let ids = []

                    for(var i = 0; i < list.length; ++i){
                        ids.push(list[i].id);
                    }
                    let request = $.ajax({
>>>>>>> 1c5155a (JavaScript rewrite for editing quizzes, Quiz Label, LaTeX image support with URL (implemented edit_quiz and associated add_question and add_support pages))
=======

        <iframe src="footer.html" width="100%" frameBorder="0"></iframe>
        <script type = "text/javascript">

            function create_buttons(button_wrapper){
                let questions_list = document.getElementById("questions_list");
                let ul = document.createElement("ul");
                $(ul).addClass("unbulleted_list");

                let delete_button_li = document.createElement("li");
                let delete_button = document.createElement("button");
                delete_button.innerHTML = "Delete";
                $(delete_button).addClass("delete");
                delete_button.addEventListener('click', function(event){
                    remove(event.target, questions_list);
                });
                delete_button_li.appendChild(delete_button);
                
                let up_button_li = document.createElement("li");
                let up_button = document.createElement("button");
                let up_button_image = document.createElement("img");
                up_button_image.src = "{% static 'up_arrow.svg' %}";
                up_button_image.width = 50;
                up_button.appendChild(up_button_image);
                up_button.addEventListener('click', function(event){
                    decrease_order(event.target, questions_list);
                });
                up_button_li.appendChild(up_button);

                let down_button_li = document.createElement("li");
                let down_button = document.createElement("button");
                let down_button_image = document.createElement("img");
                down_button_image.src = "{% static 'down_arrow.svg' %}";
                down_button_image.width = 50;
                down_button.appendChild(down_button_image);
                down_button.addEventListener('click', function(event){
                    increase_order(event.target, questions_list);
                });
                down_button_li.appendChild(down_button);

                ul.appendChild(delete_button_li);
                ul.appendChild(up_button_li);
                ul.appendChild(down_button_li);
                button_wrapper.appendChild(ul);
            }

             // Function to handle deletions
             function remove(button, questions_list) {
                console.log(questions_list);
                let list_element = questions_list;
                let list = list_element.children;
                let index = -1;

                for(let i = 0; i < list.length; ++i){
                    if(list[i].contains(button)){
                        index = i;
                    }
                }

                for(let i = 0; i < list.length; ++i){
                    if(i > index){
                        list[i].getElementsByClassName("question_ordering")[0].innerHTML = (i - 1).toString();
                    }
                    if(list[i].contains(button)){
                        index = i;
                    }
                }
                list_element.removeChild(list[index]);
            }
            
            // Function to handle increasing order
            function increase_order(button, questions_list){
                let list_element = questions_list;
                let list = list_element.children;
            
                let index = -1;
                for(let i = 0; i < list.length; ++i){
                    if(list[i].contains(button)){
                        index = i;
                    }
                }
                
                if(index != list.length-1){
                    list[index].getElementsByClassName("question_ordering")[0].innerHTML = (index + 1).toString();
                    list[index + 1].getElementsByClassName("question_ordering")[0].innerHTML = (index).toString();
                    list[index].parentNode.insertBefore(list[index+1], list[index]);   
                    list[index + 1].scrollIntoView();
                }
            }

            // Function to handle decreasing order
            function decrease_order(button, questions_list){
                let list_element = questions_list;
                let list = list_element.children;
            
                let index = -1;
                for(let i = 0; i < list.length; ++i){
                    if(list[i].contains(button)){
                        index = i;
                    }
                }
                
                if(index != 0){
                    list[index].getElementsByClassName("question_ordering")[0].innerHTML = (index - 1).toString();
                    list[index - 1].getElementsByClassName("question_ordering")[0].innerHTML = (index).toString();
                    list[index-1].parentNode.insertBefore(list[index], list[index-1]);
                    list[index-1].scrollIntoView();
                }
            }

            $(document).ready(function() {
                console.log("HELLO");
                // Fetch questions list
                let request = $.ajax({
                    type: "GET",
                    url: "/edit_quiz/{{quiz_instance.quiz_id}}",
                    dataType: 'json',
                    data:{
                        csrfmiddlewaretoken: "{{csrf_token}}",
                        command: "fetch_quiz_questions"
                    }
                });
                request.done(function(data){
                    display_questions(data, "questions_list", create_buttons, true);
                });

                // Function to handle saving
                $('#save_button').on('click', function(event){
                    let list = document.getElementById("questions_list").children;
                    let ids = []

                    for(var i = 0; i < list.length; ++i){
                        ids.push(list[i].id);
                    }
                    console.log("LABEL VALUE");
                    console.log(document.getElementById("label").value);
                    let request = $.ajax({
>>>>>>> a8bcbf5 (JavaScript rewrite for editing quizzes, Quiz Label, LaTeX image support with URL (implemented edit_quiz and associated add_question and add_support pages))
                        type: "POST",
                        url: "/edit_quiz/{{quiz_instance.quiz_id}}",
                        dataType: 'json',
                        data:{
                            csrfmiddlewaretoken: "{{csrf_token}}",
                            command: "save",
                            ids: JSON.stringify(ids),
                            label: document.getElementById("label").value,
                            conceptual_difficulty: document.getElementById("conceptual_difficulty").value,
                            time_required_mins: document.getElementById("time_required_mins").value,
                            calculator_allowed: document.getElementById("calculator_allowed").checked,
                            computer_allowed: document.getElementById("computer_allowed").checked,
                            internet_allowed: document.getElementById("internet_allowed").checked,
                            book_allowed: document.getElementById("book_allowed").checked,
                            volume: document.getElementById("volume").value,
                            chapter: document.getElementById("chapter").value
                        }
                    });

                    request.done(function(){
                        const save_status = document.getElementById("save_status");
                        const save_date = new Date();
                        save_status.innerHTML = "Quiz sucessfully downloaded!"
                    });

                    request.fail(function(){
                        const save_status = document.getElementById("save_status");
                        const save_date = new Date();
                        save_status.innerHTML = "Quiz download failed...";
                    });

                });

                $('#download_button').on('click', function(event){
                    var list = document.getElementById("quiz_questions_list").children;
                    var orderings = []
                    var ids = []

                    for(var i = 0; i < list.length; ++i){
                        ids.push(list[i].id);
                        orderings.push(i);
                    }

                    var request = $.ajax({
                        type: "POST",
                        url: "/edit_quiz/{{quiz_instance.quiz_id}}",
                        dataType: 'json',
                        data:{
                            csrfmiddlewaretoken: "{{csrf_token}}",
                            command: "download",
                            orderings: JSON.stringify(orderings),
                            ids: JSON.stringify(ids)
                        }
                    });

                    request.done(function(){
                        const save_status = document.getElementById("save_status");
                        const save_date = new Date();
                        save_status.innerHTML = "Quiz sucessfully downloaded!"
                    });

                    request.fail(function(){
                        const save_status = document.getElementById("save_status");
                        const save_date = new Date();
                        save_status.innerHTML = "Quiz download failed...";
                    });
<<<<<<< HEAD

                });

                $('#download_button').on('click', function(event){
                    var list = document.getElementById("quiz_questions_list").children;
                    var orderings = []
                    var ids = []

                    for(var i = 0; i < list.length; ++i){
                        ids.push(list[i].id);
                        orderings.push(i);
                    }

                    var request = $.ajax({
                        type: "POST",
                        url: "/edit_quiz/{{quiz_instance.quiz_id}}",
                        dataType: 'json',
                        data:{
                            csrfmiddlewaretoken: "{{csrf_token}}",
                            command: "download",
                            orderings: JSON.stringify(orderings),
                            ids: JSON.stringify(ids)
                        }
                    });

                    request.done(function(){
                        const save_status = document.getElementById("save_status");
                        save_status.innerHTML = "Quiz sucessfully downloaded!"
                    });

                    request.fail(function(){
                        const save_status = document.getElementById("save_status");
                        save_status.innerHTML = "Quiz download failed...";
                    });

<<<<<<< HEAD
>>>>>>> c58b4ad (Initial changes for pdf rendering)
=======
>>>>>>> fdd0d72 (Migrated download button)
=======
>>>>>>> a8bcbf5 (JavaScript rewrite for editing quizzes, Quiz Label, LaTeX image support with URL (implemented edit_quiz and associated add_question and add_support pages))
                });

                request.done(function () {
                    const save_status = document.getElementById("save_status");
                    const save_date = new Date();
                    save_status.innerHTML = "Success! Quiz Saved at " + save_date.toString();
=======
            const form = document.getElementById("form");

            // TODO use ajax for submit
            /* override submit button action
            $("#form").submit( function(){
                request =  $.ajax({
                    type: "POST",
                    url: "/make_quiz/{{quiz_instance.quiz_id}}",
                    dataType: 'json',
                    data:{
                        csrfmiddlewaretoken: "{{csrf_token}}",
                        form: $(this).val()
                    }, 

                    success:function(response){
                        console.log("response");
                    if(response.success) {
                        console.log("success");
                    } else {
                        console.log("failure");
                    }
                    }   
>>>>>>> 0bb1265 (fixes)
                });

                request.fail(function () {
                    const save_status = document.getElementById("save_status");
                    const save_date = new Date();
                    save_status.innerHTML = "Oh no! There was an error saving at: " + save_date.toString();
                });

            });
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
=======
            */

            // TODO modify when add question page is added
            // function to save
            $('#save_button').on('click', function (event) {
                var list = document.getElementById("quiz_questions_list").children;
                var orderings = []
                var ids = []

                for (var i = 0; i < list.length; ++i) {
                    ids.push(list[i].id);
                    orderings.push(i);
                }

                var request = $.ajax({
                    type: "POST",
                    url: "/edit_quiz/{{quiz_instance.quiz_id}}",
                    dataType: 'json',
                    data: {
                        csrfmiddlewaretoken: "{{csrf_token}}",
                        command: "save",
                        orderings: JSON.stringify(orderings),
                        ids: JSON.stringify(ids)
                    }
                });

                request.done(function () {
                    const save_status = document.getElementById("save_status");
                    const save_date = new Date();
                    save_status.innerHTML = "Success! Quiz Saved at " + save_date.toString();
                });

                request.fail(function () {
                    const save_status = document.getElementById("save_status");
                    const save_date = new Date();
                    save_status.innerHTML = "Oh no! There was an error saving at: " + save_date.toString();
                });

            });
>>>>>>> 0bb1265 (fixes)

            // Function to handle deletions
            $('.delete').on('click', function (event) {
                var list_element = document.getElementById("quiz_questions_list");
                var list = document.getElementById("quiz_questions_list").children;
                var index = -1;

                for (var i = 0; i < list.length; ++i) {
                    if (list[i].contains($(this)[0])) {
                        index = i;
                    }
                }

                for (var i = 0; i < list.length; ++i) {
                    if (i > index) {
                        list[i].getElementsByClassName("question_ordering")[0].innerHTML = (i - 1).toString();
                    }
                    if (list[i].contains($(this)[0])) {
                        index = i;
                    }
                }
                list_element.removeChild(list[index]);
            });

<<<<<<< HEAD
            // Function to toggle attachment visibility
            $('.attachments_button').on('click', function (event) {
                toggle_attachments_visible("quiz_questions_list", $(this)[0], "attachments");
            });

=======
>>>>>>> 0bb1265 (fixes)
            // Function to handle increasing order
            $('.increase_order').on('click', function (event) {
                var list = document.getElementById("quiz_questions_list").children;

                var index = -1;
                for (var i = 0; i < list.length; ++i) {
                    if (list[i].contains($(this)[0])) {
                        index = i;
                    }
                }

                if (index != list.length - 1) {
                    list[index].getElementsByClassName("question_ordering")[0].innerHTML = (index + 1).toString();
                    list[index + 1].getElementsByClassName("question_ordering")[0].innerHTML = (index).toString();
                    list[index].parentNode.insertBefore(list[index + 1], list[index]);
                    list[index + 1].scrollIntoView();
<<<<<<< HEAD
                }
            });

=======

                }
            });


>>>>>>> 0bb1265 (fixes)
            // Function to handle decreasing order
            $('.decrease_order').on('click', function (event) {
                var list = document.getElementById("quiz_questions_list").children;

                var index = -1;
                for (var i = 0; i < list.length; ++i) {
                    if (list[i].contains($(this)[0])) {
                        index = i;
                    }
                }

                if (index != 0) {
                    list[index].getElementsByClassName("question_ordering")[0].innerHTML = (index - 1).toString();
                    list[index - 1].getElementsByClassName("question_ordering")[0].innerHTML = (index).toString();
                    list[index - 1].parentNode.insertBefore(list[index], list[index - 1]);
                    list[index - 1].scrollIntoView();
                }
            });
<<<<<<< HEAD
        });
    </script>
=======

=======
>>>>>>> 1c5155a (JavaScript rewrite for editing quizzes, Quiz Label, LaTeX image support with URL (implemented edit_quiz and associated add_question and add_support pages))
=======
>>>>>>> a8bcbf5 (JavaScript rewrite for editing quizzes, Quiz Label, LaTeX image support with URL (implemented edit_quiz and associated add_question and add_support pages))
            function confirmLeave() {
                const modal = document.getElementById('customModal');
                modal.style.display = 'inline-block';
            }

            function saveChanges() {
                document.getElementById('save_button').click();
                location.href = '/main'
                closeModal();
            }

            function leaveWithoutSaving() {
                location.href = '/main'
                closeModal();
            }

            function cancelLeave() {
                closeModal();
            }

            function closeModal() {
                const modal = document.getElementById('customModal');
                modal.style.display = 'none';
            }
        </script>
<<<<<<< HEAD
<<<<<<< HEAD
>>>>>>> 830dbfb (save changes windows)

</body>
=======
    </body>
>>>>>>> 1c5155a (JavaScript rewrite for editing quizzes, Quiz Label, LaTeX image support with URL (implemented edit_quiz and associated add_question and add_support pages))
=======
    </body>
>>>>>>> a8bcbf5 (JavaScript rewrite for editing quizzes, Quiz Label, LaTeX image support with URL (implemented edit_quiz and associated add_question and add_support pages))

</html>